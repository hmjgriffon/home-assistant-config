group:
  Media:
    entities:
      - input_select.family_room_media


media_player:
  - platform: spotify
    client_id: !secret spotify_client
    client_secret: !secret spotify_secret


remote:
  - platform: harmony
    name: Family Room
    host: !secret harmony_host


input_select:
  family_room_media:
    name: Family Room
    options:
      - Power Off
      - Apple TV
      - DVD Player
      - Music
      - Bluetooth
    initial: Power Off
    icon: mdi:television


automation:
  - alias: Media input updates based on remote status
    initial_state: True
    hide_entity: True
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id: remote.family_room
    action:
      - service: input_select.select_option
        data_template:
          entity_id: input_select.family_room_media
          option: >
            {% if states.remote.family_room.attributes.current_activity == 'Apple TV' %}
              Apple TV
            {% elif states.remote.family_room.attributes.current_activity == 'DVD Player' %}
              DVD Player
            {% elif states.remote.family_room.attributes.current_activity == 'Music' %}
              Music
            {% elif states.remote.family_room.attributes.current_activity == 'Bluetooth Speakers' %}
              Bluetooth
            {% else %}
              Power Off
            {% endif %}

  - alias: Media input changes trigger remote
    initial_state: True
    hide_entity: True
    trigger:
      platform: state
      entity_id: input_select.family_room_media
    action:
      service: remote.turn_on
      data_template:
        entity_id: remote.family_room
        activity: >
          {% if states.input_select.family_room_media.state == 'Apple TV' %}
            21762413
          {% elif states.input_select.family_room_media.state == 'DVD Player' %}
            21762603
          {% elif states.input_select.family_room_media.state == 'Music' %}
            18890244
          {% elif states.input_select.family_room_media.state == 'Bluetooth' %}
            22068322
          {% else %}
            -1
          {% endif %}